@page "/client/assets"
@using Microsoft.AspNetCore.Authorization
@using ToroTrack.Components.Layout
@*attribute [Authorize(Roles = "Client")]*@
@rendermode InteractiveServer

<PageTitle>My Assets | Toro Track</PageTitle>

<div class="page-shell">
    <header class="content-header">
        <div>
            <h1 class="page-title">Assets & Licenses</h1>
            <p class="page-subtitle">Track your organization's hardware inventory and software subscriptions.</p>
        </div>
        <div class="header-right">
            <div class="summary-badge">
                <span class="bi bi-pc-display me-2"></span> @HardwareList.Count Devices
            </div>
            <div class="summary-badge ms-2">
                <span class="bi bi-card-checklist me-2"></span> @LicenseList.Count Active Licenses
            </div>
        </div>
    </header>

    <div class="assets-grid">

        @* SECTION 1: SOFTWARE LICENSES *@
        <section class="asset-section">
            <h3 class="section-header">
                <span class="bi bi-microsoft me-2"></span> Software Licenses
            </h3>
            <div class="table-responsive">
                <table class="toro-table">
                    <thead>
                        <tr>
                            <th style="width: 40%">Software</th>
                            @* Why: Replaced Seats with Expiry Date as requested *@
                            <th style="width: 30%">Expiry Date</th>
                            <th style="width: 30%" class="text-center">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var license in LicenseList)
                        {
                            <tr>
                                <td class="fw-bold">@license.Name</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <span class="bi bi-calendar-event me-2 text-muted"></span>
                                        @license.ExpiryDate.ToString("MMM dd, yyyy")

                                        @* Why: Alert logic for expiring items *@
                                        @if ((license.ExpiryDate - DateTime.Now).TotalDays < 30)
                                        {
                                            <span class="bi bi-exclamation-triangle-fill text-warning ms-2" title="Expiring Soon"></span>
                                        }
                                    </div>
                                </td>
                                <td class="text-center">
                                    @if (license.IsActive)
                                    {
                                        <span class="status-pill active">Active</span>
                                    }
                                    else
                                    {
                                        <span class="status-pill expired">Expired</span>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </section>

        @* SECTION 2: HARDWARE INVENTORY *@
        <section class="asset-section mt-4">
            <h3 class="section-header">
                <span class="bi bi-laptop me-2"></span> Hardware Inventory
            </h3>
            <div class="table-responsive">
                <table class="toro-table">
                    <thead>
                        <tr>
                            <th style="width: 25%">Device Type</th>
                            <th style="width: 25%">Model / Specs</th>
                            <th style="width: 25%">Assigned To</th>
                            <th style="width: 25%">Serial No.</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in HardwareList)
                        {
                            <tr>
                                <td>
                                    @if (item.Type == "Laptop")
                                    {
                                        <span class="bi bi-laptop me-2 text-muted"></span>
                                    }
                                    else if (item.Type == "Server")
                                    {

                                        <span class="bi bi-hdd-rack me-2 text-muted"></span>
                                    }
                                    else
                                    {

                                        <span class="bi bi-printer me-2 text-muted"></span>
                                    }
                                    @item.Type
                                </td>
                                <td>@item.Model</td>
                                <td>
                                    @if (string.IsNullOrEmpty(item.AssignedUser))
                                    {
                                        <span class="text-muted fst-italic">Unassigned</span>
                                    }
                                    else
                                    {
                                        <span class="user-badge">@item.AssignedUser</span>
                                    }
                                </td>
                                <td class="text-monospace text-muted">@item.SerialNumber</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </section>

    </div>
</div>

@code {
    // --- MODELS ---
    public class SoftwareLicense
    {
        public string Name { get; set; } = "";
        // Why: Removed SeatCount as per instruction
        public DateTime ExpiryDate { get; set; }
        public bool IsActive => ExpiryDate > DateTime.Now;
    }

    public class HardwareItem
    {
        public string Type { get; set; } = ""; // Laptop, Printer, Server
        public string Model { get; set; } = "";
        public string SerialNumber { get; set; } = "";
        public string AssignedUser { get; set; } = "";
    }

    // --- MOCK DATA ---
    private List<SoftwareLicense> LicenseList = new();
    private List<HardwareItem> HardwareList = new();

    protected override async Task OnInitializedAsync()
    {
        // In a real app, this would fetch from DB based on ClientID
        await Task.Delay(300);

        LicenseList = new List<SoftwareLicense>
        {
            new SoftwareLicense { Name = "Microsoft 365 Business Standard", ExpiryDate = DateTime.Now.AddDays(200) },
            new SoftwareLicense { Name = "ESET Endpoint Protection", ExpiryDate = DateTime.Now.AddDays(15) }, // Expiring soon
            new SoftwareLicense { Name = "Adobe Creative Cloud", ExpiryDate = DateTime.Now.AddDays(300) }
        };

        HardwareList = new List<HardwareItem>
        {
            new HardwareItem { Type = "Laptop", Model = "Dell Latitude 5420", SerialNumber = "DL-554920", AssignedUser = "Sarah Smith" },
            new HardwareItem { Type = "Laptop", Model = "Dell Latitude 5420", SerialNumber = "DL-554921", AssignedUser = "John Doe" },
            new HardwareItem { Type = "Laptop", Model = "MacBook Pro M2", SerialNumber = "AP-993821", AssignedUser = "Design Team" },
            new HardwareItem { Type = "Printer", Model = "HP LaserJet Pro", SerialNumber = "HP-112233", AssignedUser = "Office Floor 2" },
            new HardwareItem { Type = "Server", Model = "Dell PowerEdge T40", SerialNumber = "SV-883344", AssignedUser = "Server Room" }
        };
    }
}