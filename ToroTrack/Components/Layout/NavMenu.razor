@using Microsoft.AspNetCore.Components.Authorization
@using System.Security.Claims

<div class="nav-wrapper">

    @* 1. Header *@
    <div class="nav-header">
        <div class="logo-container">
            <img src="/appImages/toro-icon.png" alt="Toro Logo" />
        </div>
        <span class="app-title">Toro Track</span>
    </div>

    <div class="nav-divider"></div>

    @* 2. Scrollable Links Area *@
    <div class="nav-links-scroll">
        <NavMenuLinks />
    </div>

    @* 3. User Footer (Pinned to Bottom) *@
    <div class="user-footer">
        <AuthorizeView>
            <Authorized>
                @* User Info Card *@
                <div class="user-card">
                    <div class="avatar">
                        <img src="/appImages/toro-icon.png" alt="User Avatar" style="width:100%; height:100%; object-fit:cover;" />
                    </div>
                    <div class="user-details">
                        <span class="user-name">@context.User.Identity?.Name</span>
                        @* LOGIC: Dynamically show role *@
                        <span class="user-role">@GetUserRole(context.User)</span>
                    </div>
                </div>

                @* LOGOUT BUTTON - Redirects to Welcome Page *@
                <form action="/Account/Logout" method="post" data-enhance="false">
                    <AntiforgeryToken />
                    @* Why: ReturnUrl is set to "/" to ensure redirect goes to the Welcome page *@
                    <input type="hidden" name="ReturnUrl" value="/" />

                    @* Why: onclick handles the immediate visual feedback 'Logging Out...' before the form posts *@
                    <button type="submit" class="logout-btn" onclick="this.innerText = 'Logging Out...';">
                        LOGOUT
                    </button>
                </form>
            </Authorized>
            <NotAuthorized>
                @* If not logged in, show login button *@
                <div class="p-2">
                    <a href="Account/Login" class="btn btn-sm btn-outline-light w-100">Login</a>
                </div>
            </NotAuthorized>
        </AuthorizeView>
    </div>

</div>

@code {
    // Why: Determines the display name for the user's role
    private string GetUserRole(ClaimsPrincipal user)
    {
        if (user.IsInRole("Admin")) return "Administrator";
        if (user.IsInRole("Auditor")) return "Auditor";
        if (user.IsInRole("TeamMember")) return "Team Member";
        if (user.IsInRole("Client")) return "Client";

        return "User"; // Fallback
    }
}