@using Microsoft.AspNetCore.Components.Authorization
@using System.Security.Claims

<div class="nav-wrapper">

    @* 1. Header *@
    <div class="nav-header">
        <div class="logo-container">
            <img src="/appImages/toro-icon.png" alt="Toro Logo" />
        </div>
        <span class="app-title">Toro Track</span>
    </div>

    <div class="nav-divider"></div>

    @* 2. Scrollable Links Area - Now uses the component *@
    <div class="nav-links-scroll">
        <NavMenuLinks /> 
    </div>

    @* 3. User Footer (Pinned to Bottom) *@
    <div class="user-footer">
        <AuthorizeView>
            <Authorized>
                @* User Info Card *@
                <div class="user-card">
                    <div class="avatar">
                        <img src="/appImages/toro-icon.png" alt="User Avatar" style="width:100%; height:100%; object-fit:cover;" />
                    </div>
                    <div class="user-details">
                        <span class="user-name">@context.User.Identity?.Name</span>
                        <span class="user-role">@GetUserRole(context.User)</span>
                    </div>
                </div>

                @* LOGOUT BUTTON - Redirects to Welcome Page *@
                <form action="Account/Logout" method="post">
                    <AntiforgeryToken />
                    <input type="hidden" name="ReturnUrl" value="/" />
                    <button type="submit" class="logout-btn">
                        LOGOUT
                    </button>
                </form>
            </Authorized>
        </AuthorizeView>
    </div>

</div>

@code {
    private string GetUserRole(ClaimsPrincipal user)
    {
        if (user.IsInRole("Admin")) return "Administrator";
        if (user.IsInRole("Auditor")) return "Auditor";
        if (user.IsInRole("TeamMember")) return "Team Member";
        if (user.IsInRole("Client")) return "Client";
        return "User";
    }
}